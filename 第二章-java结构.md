### java对象结构

java对象主要由三部分组成：对象头、实例数据和对齐填充。

#### 对象头

主要包含两类数据：

- Mark world：保存对象运行时数据，比如hashcode、锁标志位，偏向锁信息、对象分代年龄。占用32位或64位（32位和64虚拟机）。

  | 存储内容                                         | 标志 | 状态     |
  | ------------------------------------------------ | ---- | -------- |
  | 指向锁记录的指针                                 | 00   | 轻量级锁 |
  | 对象的hashcode、对象分代年龄、偏向标志位         | 01   | 未锁定   |
  | 偏向线程ID、偏向时间戳、对象分代年龄、偏向标志位 | 01   | 可偏向   |
  | 指向重量级锁的指针                               | 10   | 重量级锁 |
  | 空、不需要记录                                   | 11   | GC标记   |

  以下为详细版本的说明：

  ![1638750385302](D:\学习\高并发研究\assets\1638750385302.png)

- 对象的类型指针：指向方法区对象所属的Class对象，占用32位或64位（32位或64位虚拟机）。如果是数组会包含数组的长度。jvm可以通过该位置的值确定实例数据的占用空间的大小了，从而可以确定为该对象分配合适的内存。

#### 实例数据

该区域会保存对象及其父类的所有属性值

#### 对齐填充

jvm要求对象的占用空间必须为8字节的整数倍。在对象头总共占用64/128字节（jvm为32或64位）的情况下，实例数据的尺寸可能不满足该条件，当不满足时通过该区域的填充让对象的总大小为8字节的倍数。

#### 参考文献

- 《深入理解java虚拟机》2.3.2节：对象的内存布局

